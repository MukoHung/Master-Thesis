param (
  $ifName = "Wi-Fi", # Interface to be searched 
  $router = "192.168.0.1" # Home router's IP address ;)
)


# CIDR-s to be added to ignore VPN

$cidrs = @("192.168.0.0/24","104.16.0.0/12", "99.78.128.0/17", "99.79.0.0/16", "99.80.0.0/15", "99.82.0.0/17", "99.82.128.0/18", "108.128.0.0/13","108.136.0.0/14", 
"8.8.4.0/24","66.249.64.0/19","209.85.128.0/17","74.125.0.0/16","173.194.0.0/16","8.8.8.0/24","66.102.0.0/20","216.239.32.0/19","72.14.192.0/18","64.233.160.0/19",
"70.32.128.0/19","108.170.192.0/18","193.120.166.64/26","149.3.176.0/24","192.178.0.0/15","4.3.2.0/24","108.177.0.0/17","90.84.58.0/26","217.163.7.0/24","108.59.80.0/20",
"149.3.177.0/24","8.35.200.0/21","41.206.47.0/25","80.239.142.192/26","213.144.182.0/26","8.35.192.0/21","172.217.0.0/16","89.207.224.0/21","192.158.28.0/22","192.119.16.0/20",
"193.51.224.128/26","8.34.216.0/21","142.250.0.0/15","92.241.132.64/26","193.142.125.0/24","172.253.0.0/16","77.67.49.64/26","213.152.1.64/27","199.223.232.0/21","193.186.4.0/24",
"162.222.176.0/21","8.34.208.0/21","80.228.66.128/25","86.127.118.128/26","23.228.128.0/18","88.204.177.192/26","23.236.48.0/20","195.22.207.0/26","23.251.128.0/19","199.192.112.0/22",
"80.227.152.32/29","80.149.20.0/26","200.202.122.0/24","113.21.241.0/26","107.167.160.0/19","62.231.91.64/26","80.149.20.64/26","216.21.160.0/20","107.178.192.0/18","146.148.0.0/17",
"107.188.128.0/17","130.211.0.0/16","104.132.0.0/14","217.30.152.192/27","104.154.0.0/15","104.196.0.0/14","216.58.192.0/19","62.78.98.128/26","45.56.0.0/18","192.104.160.0/23",
"207.223.160.0/20","95.80.231.0/26","99.198.128.0/17","212.188.10.0/24","216.252.220.0/22","212.188.7.0/24","212.6.83.0/26","192.200.224.0/19","212.6.83.64/26","162.216.148.0/22",
"23.255.128.0/17","62.78.98.192/26","172.102.8.0/21","200.16.69.224/27","179.124.224.0/26","41.206.188.128/26","136.32.0.0/11","209.107.176.0/20","213.155.151.128/26","217.75.205.128/26",
"146.88.60.0/24","89.166.85.192/26","185.54.255.0/26","199.87.241.32/27","195.50.84.192/26","213.242.93.64/26","208.68.108.0/22","82.212.91.0/26","200.16.69.192/27","93.94.218.0/27",
"209.185.108.128/25","35.184.0.0/13","35.192.0.0/12","80.77.67.240/28","185.150.148.0/22","35.208.0.0/12","35.224.0.0/12","35.240.0.0/13","212.91.114.0/28","131.161.109.0/27",
"199.36.152.0/21","41.189.230.0/24","208.81.188.0/22","170.254.11.32/27","74.114.24.0/21","200.16.69.128/27","80.77.67.192/27","113.197.104.0/23","113.197.106.0/23",
"177.129.160.192/27","64.18.0.0/20","185.25.28.0/23","136.22.6.0/23","201.87.155.148/30","185.54.255.64/27","207.126.144.0/20","185.25.30.0/24","185.25.31.0/24","136.112.0.0/12",
"136.22.0.0/23","34.64.0.0/10","154.73.81.0/26","200.16.69.160/27","80.77.106.64/28","173.255.112.0/20","187.86.80.64/26","219.99.135.0/27","208.76.68.0/22","93.91.155.128/26",
"202.96.28.0/27","80.77.67.224/28","185.54.255.96/27","208.87.172.0/22","189.45.9.0/26","77.67.114.128/26","195.110.67.192/29","164.160.139.96/27","213.244.180.64/26","64.235.254.0/26",
"93.94.217.0/27","195.72.240.0/26","46.105.191.144/28","63.88.22.0/23","138.121.75.64/27","177.128.223.192/26","216.147.171.192/26","179.96.250.64/26","212.6.86.128/25","177.66.110.128/27",
"74.94.170.0/28","80.231.71.0/24","34.128.0.0/10","64.17.244.0/27","65.214.112.96/27","50.220.179.224/29","38.104.152.0/30");



Write-Host "Searching interface named $($ifName)" -ForegroundColor Blue
$interfaceIndex = $(Get-NetIPInterface -InterfaceAlias $ifName)
if ($null -eq $interfaceIndex) {
  Write-Host "The interface named '$($ifName)' was not found." -ForegroundColor Red
  return;
} else {
  Write-Host "'$($ifName)' interface found at ix#$($interfaceIndex.ifIndex)" -ForegroundColor Green
}
foreach($subnet in $cidrs) {
  Write-Host "Searching for existing route on subnet '$($subnet)'" -ForegroundColor Blue
  $currentRoute = $(Get-NetRoute -DestinationPrefix "$subnet" -InterfaceIndex $interfaceIndex)

  if ($null -ne $currentRoute) {
    if ($currentRoute.NextHop -eq $router) {
      Write-Host "The current route seems to be useful, doesn't need to do anything." -ForegroundColor Green
      continue;
    } else {
      Write-Host "There is a route, which doesn't work for us, we'll delete it first." -ForegroundColor Blue
      Remove-NetRoute -DestinationPrefix "$($subnet)"
      Write-Host "The old route has been removed" -ForegroundColor Green
    }
  } else {
    Write-Host "The route can't be found currently, adding new one!" -ForegroundColor Blue
  }

  New-NetRoute -DestinationPrefix $subnet -NextHop "$router" -InterfaceIndex "$($interfaceIndex.ifIndex)"
  Write-Host "The new route was added successfully! You can now reach your local network @ '$($subnet)'"
}

# Remove-NetRoute -DestinationPrefix "192.168.0.0"
